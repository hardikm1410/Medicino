<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Medicino</title>
    <link rel="stylesheet" href="/static/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <img src="/static/logo.png" alt="Medicino Logo">
                <span>Medicino</span>
            </div>
            <div class="nav-menu">
                <a href="{{ url_for('main.dashboard') }}" class="nav-link active">
                    <i class="fas fa-home"></i> Dashboard
                </a>
                <a href="{{ url_for('main.main_app') }}" class="nav-link">
                    <i class="fas fa-stethoscope"></i> Diagnosis
                </a>
                <a href="{{ url_for('main.medicines') }}" class="nav-link">
                    <i class="fas fa-pills"></i> Medicines
                </a>
                <a href="{{ url_for('main.history') }}" class="nav-link">
                    <i class="fas fa-history"></i> History
                </a>
                <div class="nav-dropdown">
                    <button class="nav-dropdown-btn">
                        <i class="fas fa-user"></i> {{ current_user.full_name or current_user.username }}
                        <i class="fas fa-chevron-down"></i>
                    </button>
                    <div class="nav-dropdown-content">
                        <a href="{{ url_for('auth.profile') }}">
                            <i class="fas fa-user-edit"></i> Profile
                        </a>
                        <a href="{{ url_for('auth.change_password') }}">
                            <i class="fas fa-key"></i> Change Password
                        </a>
                        <a href="{{ url_for('auth.logout') }}">
                            <i class="fas fa-sign-out-alt"></i>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="dashboard-container">
        <!-- Welcome Section -->
        <section class="welcome-section">
            <div class="welcome-content">
                <h1>Welcome back, {{ current_user.full_name or current_user.username }}!</h1>
                <p>Your health companion is ready to help you with symptom diagnosis and medicine information.</p>
            </div>
            <div class="welcome-actions">
                <a href="{{ url_for('main.main_app') }}" class="btn btn-primary">
                    <i class="fas fa-stethoscope"></i> Start Diagnosis
                </a>
                <a href="{{ url_for('main.medicines') }}" class="btn btn-secondary">
                    <i class="fas fa-pills"></i> Browse Medicines
                </a>
            </div>
        </section>

        <!-- Quick Stats -->
        <section class="stats-section">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-clipboard-list"></i>
                    </div>
                    <div class="stat-content">
                        <h3 id="totalDiagnoses">-</h3>
                        <p>Total Diagnoses</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-calendar-check"></i>
                    </div>
                    <div class="stat-content">
                        <h3 id="recentDiagnoses">-</h3>
                        <p>This Month</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-heart"></i>
                    </div>
                    <div class="stat-content">
                        <h3 id="healthScore">-</h3>
                        <p>Health Score</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-clock"></i>
                    </div>
                    <div class="stat-content">
                        <h3 id="lastVisit">-</h3>
                        <p>Last Visit</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Quick Actions -->
        <section class="actions-section">
            <h2>Quick Actions</h2>
            <div class="actions-grid">
                <a href="{{ url_for('main.main_app') }}" class="action-card">
                    <div class="action-icon">
                        <i class="fas fa-stethoscope"></i>
                    </div>
                    <h3>Symptom Diagnosis</h3>
                    <p>Get instant diagnosis based on your symptoms</p>
                </a>
                <a href="{{ url_for('main.medicines') }}" class="action-card">
                    <div class="action-icon">
                        <i class="fas fa-pills"></i>
                    </div>
                    <h3>Medicine Database</h3>
                    <p>Search and learn about medicines</p>
                </a>
                <a href="{{ url_for('main.history') }}" class="action-card">
                    <div class="action-icon">
                        <i class="fas fa-history"></i>
                    </div>
                    <h3>Diagnosis History</h3>
                    <p>View your past diagnoses and treatments</p>
                </a>
                <a href="{{ url_for('main.symptoms') }}" class="action-card">
                    <div class="action-icon">
                        <i class="fas fa-list-ul"></i>
                    </div>
                    <h3>Symptoms Reference</h3>
                    <p>Browse common symptoms and conditions</p>
                </a>
            </div>
        </section>

        <!-- Recent Activity -->
        <section class="activity-section">
            <h2>Recent Activity</h2>
            <div class="activity-list" id="recentActivity">
                <div class="loading">Loading recent activity...</div>
            </div>
        </section>

        <!-- Health Tips -->
        <section class="tips-section">
            <h2>Health Tips</h2>
            <div class="tips-grid">
                <div class="tip-card">
                    <div class="tip-icon">
                        <i class="fas fa-water"></i>
                    </div>
                    <h3>Stay Hydrated</h3>
                    <p>Drink at least 8 glasses of water daily to maintain good health.</p>
                </div>
                <div class="tip-card">
                    <div class="tip-icon">
                        <i class="fas fa-bed"></i>
                    </div>
                    <h3>Get Enough Sleep</h3>
                    <p>Aim for 7-9 hours of quality sleep each night for optimal health.</p>
                </div>
                <div class="tip-card">
                    <div class="tip-icon">
                        <i class="fas fa-walking"></i>
                    </div>
                    <h3>Stay Active</h3>
                    <p>Regular exercise helps maintain physical and mental well-being.</p>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-section">
                <h3>Medicino</h3>
                <p>Your trusted health companion for symptom diagnosis and medicine information.</p>
            </div>
            <div class="footer-section">
                <h4>Quick Links</h4>
                <ul>
                    <li><a href="{{ url_for('main.about') }}">About</a></li>
                    <li><a href="{{ url_for('main.help') }}">Help</a></li>
                    <li><a href="{{ url_for('main.contact') }}">Contact</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h4>Legal</h4>
                <ul>
                    <li><a href="{{ url_for('main.privacy') }}">Privacy Policy</a></li>
                    <li><a href="{{ url_for('main.terms') }}">Terms of Service</a></li>
                    <li><a href="{{ url_for('main.disclaimer') }}">Medical Disclaimer</a></li>
                </ul>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2024 Medicino. All rights reserved.</p>
        </div>
    </footer>

    <script src="{{ url_for('static', filename='script.js') }}"></script>
    <script>
        // Dashboard specific JavaScript
        document.addEventListener('DOMContentLoaded', function() {
            loadDashboardData();
        });

        async function loadDashboardData() {
            try {
                // Load recent diagnosis history
                const historyResponse = await fetch('/api/diagnose/history?per_page=5');
                const historyData = await historyResponse.json();
                
                if (historyData.success) {
                    updateRecentActivity(historyData.data.history);
                    updateStats(historyData.data.history);
                }
            } catch (error) {
                console.error('Error loading dashboard data:', error);
            }
        }

        function updateRecentActivity(history) {
            const activityContainer = document.getElementById('recentActivity');
            
            if (history.length === 0) {
                activityContainer.innerHTML = '<p class="no-activity">No recent activity</p>';
                return;
            }

            const activityHTML = history.map(item => `
                <div class="activity-item">
                    <div class="activity-icon">
                        <i class="fas fa-stethoscope"></i>
                    </div>
                    <div class="activity-content">
                        <h4>${item.diagnosed_condition || 'Diagnosis'}</h4>
                        <p>${item.symptoms}</p>
                        <small>${new Date(item.created_at).toLocaleDateString()}</small>
                    </div>
                </div>
            `).join('');

            activityContainer.innerHTML = activityHTML;
        }

        function updateStats(history) {
            // Update total diagnoses
            document.getElementById('totalDiagnoses').textContent = history.length;

            // Update recent diagnoses (this month)
            const thisMonth = new Date().getMonth();
            const recentCount = history.filter(item => 
                new Date(item.created_at).getMonth() === thisMonth
            ).length;
            document.getElementById('recentDiagnoses').textContent = recentCount;

            // Update last visit
            if (history.length > 0) {
                const lastVisit = new Date(history[0].created_at);
                document.getElementById('lastVisit').textContent = lastVisit.toLocaleDateString();
            }

            // Calculate health score (simplified)
            const healthScore = Math.min(100, Math.max(0, 100 - (history.length * 5)));
            document.getElementById('healthScore').textContent = healthScore + '%';
        }
    </script>
</body>
</html> 